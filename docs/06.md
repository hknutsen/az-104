# Monitor and back up Azure resources

## Configure file and folder backups

- Azure Backup service
- Highlighted features:
  - Backup on-premises resources to the cloud
  - Backup Azure VMs
  - Backup Azure Files, Blobs, managed disks
  - Backup Azure Database for PostgreSQL server
  - Backups stored in Azure Recovery Services vault
  - Configure backup policies that define frequency, retention...
  - Unlimited and no cost inbound/outbound data transfer during restore operations
  - Encrypt backups with locally stored passphrase
  - Get app-consistent backups
    - No extra fixes required for the backups to work
  - Retain short- and long-term data
    - No limit on retention
    - Limit of 9,999 recovery points per instance
  - Storage replication options
    - LRS
    - ZRS
    - GRS
  - Soft delete
- Backup center
  - Unified management experience for Azure Backup
  - Govern, monitor, operate and analyze backups
- Recovery Services vault
  - Automatically manages Storage for you
  - You only need to specify replication
- Microsoft Azure Recovery Services (MARS) agent
  - Backs up on-prem resource or Azure VM to Azure Backup
  - Agent runs on the machine to be backed up.
- Configure on-prem backup:

  ![Azure Backup for on-prem server](../img/azure-backup-on-prem.png)

## Configure virtual machine backups

## Configure Azure Monitor

## Configure Azure alerts

- Configure Azure alerts to react and send notifications based on telemetry data
- Helps detect and address issues
- Prevent disruption and downtime
- Configure Azure Monitor to capture telemetry data
- Create alerts based on captured telemetry data
- An alert consists of alert rules that combine the settings and conditions you want to monitor, including:
  - Resources to monitor
  - Signals or telemetry to gather from the resources
  - Conditions to match
- If an alert rule monitors multiple resources, it triggers separately for each resource
- When an alert triggers, it sends a notification based on a configured action group
- Action group defines receivers, including:
  - Azure roles
  - Email
  - SMS
  - Webhook (Slack, Teams...)

  ![Azure alerts](../img/azure-alerts.png)

- Common alert types:
  - Metric alerts: evaluate resource metrics data at regular intervals
  - Log alerts: evaluate resource logs at a predefined frequency
  - Activity log alerts: trigger when a new activity log event occurs (e.g. when a resource is deleted)
  - Smart detection alerts: trigger on potential performance issues and failure anomalies in your web app using Application Insights
- Alert states:
  - When the conditions of an alert rule are met, an alert triggers and invokes specified action group
    - Default alert state is `New`
    - This state is set automatically by Azure
    - This is the only state that is set automatically
  - When the issue that caused the alert is in review, you can change state to `Acknowledged`
  - Once issue has been resolved (or ignored), you can change state to `Closed`
  - Possible to "repoen" alert by changing state back to `New` or `Acknowledged`
- Azure Monitor conditions:
  - When an alert triggers, the Azure Monitor condition for that alert is `Fired`
  - When the alert is closed, the Azure Monitor condition is `Resolved`
- Stateless vs stateful alerts
  - Stateless alerts trigger each time your alert rule condition matches your data, even if same alert already exists
    - Activity logs are always stateless
  - Stateful alerts trigger when your alert rule condition matches your data, and the alert does not already exist
- Create alert rule:
  - Target resource
  - Alert signal
    - Metric
    - Log
    - Activity log
    - Application Insights
  - Rule criteria
    - E.g. `CPU percentage greater than 70%`
  - Issue severity
    - 0-4, where 4 is highest severity
  - Name
  - Description
- Action groups
  - Defines receivers that should be notified of alerts:
    - Email
    - SMS
    - Azure role
  - Can also define actions:
    - Trigger Azure Function
    - Trigger Azure Automation runbook
    - Trigger webhook
  - A single action group can be reused across alerts

## Configure Log Analytics

## Configure Network Watcher

## Improve incident response with alerting on Azure

## Analyze your Azure nfrastructure by using Azure Monitor logs

## Monitor performance of virtual machines by using Azure Monitor VM Insights
